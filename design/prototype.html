<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åƒç‚¹å•¥ - å®¶åº­çƒ¹é¥ªåŠ©æ‰‹</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Roboto', -apple-system, BlinkMacSystemFont, sans-serif; background: #f5f5f5; }
        .phone-frame { width: 390px; height: 844px; margin: 40px auto; background: #fff; border-radius: 40px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; position: relative; }
        .status-bar { height: 44px; background: #6750A4; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; color: #fff; font-size: 14px; }
        .screen { height: 800px; overflow: hidden; position: relative; }
        .page { position: absolute; width: 100%; height: 100%; transition: transform 0.3s ease; background: #fff; }
        .page.hidden { transform: translateX(100%); }

        /* åº•éƒ¨å¯¼èˆª */
        .bottom-nav { position: absolute; bottom: 0; width: 100%; height: 80px; background: #fff; border-top: 1px solid #E8E8E8; display: flex; }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s; }
        .nav-item.active { color: #6750A4; }
        .nav-item:active { opacity: 0.6; }
        .nav-icon { font-size: 24px; margin-bottom: 4px; }
        .nav-label { font-size: 12px; }

        /* ä¸»é¡µ - Rollç‚¹ */
        .home { background: linear-gradient(135deg, #6750A4 0%, #7D5FA8 100%); }
        .home-header { padding: 60px 24px 40px; text-align: center; color: #fff; }
        .home-header h1 { font-size: 32px; font-weight: 700; margin-bottom: 8px; }
        .home-header p { font-size: 14px; opacity: 0.9; }
        .roll-button { width: 160px; height: 160px; margin: 60px auto 40px; background: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 8px 32px rgba(0,0,0,0.2); transition: transform 0.2s; }
        .roll-button:active { transform: scale(0.95); }
        .roll-button-inner { text-align: center; }
        .roll-button-icon { font-size: 48px; margin-bottom: 8px; }
        .roll-button-text { font-size: 18px; font-weight: 600; color: #6750A4; }

        /* æ¸è¿›å¼é…ç½® */
        .progressive-config { padding: 0 24px; display: flex; flex-direction: column; align-items: center; gap: 12px; }
        .config-btn { background: rgba(255,255,255,0.2); backdrop-filter: blur(10px); color: #fff; border: 2px solid rgba(255,255,255,0.3); padding: 12px 24px; border-radius: 24px; cursor: pointer; transition: all 0.3s; font-size: 16px; font-weight: 500; }
        .config-btn:active { background: rgba(255,255,255,0.3); }
        .config-btn.small { padding: 8px 16px; font-size: 14px; }
        .config-row { display: flex; gap: 8px; align-items: center; }

        /* é€‰æ‹©å™¨å¼¹çª— */
        .selector-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 1000; }
        .selector-overlay.show { display: flex; }
        .selector-panel { background: #fff; border-radius: 24px; padding: 24px; width: 300px; max-height: 400px; overflow-y: auto; }
        .selector-title { font-size: 20px; font-weight: 600; color: #1C1B1F; margin-bottom: 16px; text-align: center; }
        .selector-options { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
        .selector-option { background: #F5F5F5; color: #1C1B1F; padding: 16px; border-radius: 12px; text-align: center; cursor: pointer; font-size: 16px; font-weight: 500; transition: all 0.2s; }
        .selector-option:active { background: #E8DEF8; color: #6750A4; }
        .selector-option.disabled { opacity: 0.3; cursor: not-allowed; }

        /* ç»“æœé¡µ */
        .result-page { padding: 60px 24px 100px; overflow-y: auto; }
        .result-header { text-align: center; margin-bottom: 24px; }
        .result-header h2 { font-size: 24px; color: #1C1B1F; margin-bottom: 8px; }
        .result-summary { font-size: 14px; color: #79747E; }
        .dish-card { background: #fff; border-radius: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 16px; margin-bottom: 12px; }
        .dish-header { display: flex; align-items: center; gap: 12px; }
        .dish-icon { font-size: 32px; }
        .dish-info { flex: 1; }
        .dish-name { font-size: 18px; font-weight: 600; color: #1C1B1F; }
        .dish-tags { display: flex; gap: 6px; margin-top: 4px; }
        .tag { background: #E8DEF8; color: #6750A4; padding: 4px 8px; border-radius: 6px; font-size: 12px; }
        .action-buttons { display: flex; gap: 12px; padding: 0 24px 100px; }
        .btn { flex: 1; padding: 16px; border-radius: 12px; border: none; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .btn-primary { background: #6750A4; color: #fff; }
        .btn-secondary { background: #E8DEF8; color: #6750A4; }

        /* èœè°±é¡µ */
        .recipes-page { padding: 60px 0 100px; }
        .recipes-header { padding: 0 24px 16px; display: flex; justify-content: space-between; align-items: center; }
        .recipes-title { font-size: 24px; font-weight: 700; color: #1C1B1F; }
        .add-btn { background: #6750A4; color: #fff; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; cursor: pointer; }
        .filter-tabs { display: flex; gap: 8px; padding: 0 24px 16px; overflow-x: auto; }
        .filter-tab { background: #F5F5F5; color: #79747E; padding: 8px 16px; border-radius: 20px; white-space: nowrap; cursor: pointer; }
        .filter-tab.active { background: #6750A4; color: #fff; }
        .recipes-list { padding: 0 24px; }
        .recipe-item { background: #F5F5F5; border-radius: 12px; padding: 16px; margin-bottom: 12px; display: flex; align-items: center; gap: 12px; cursor: pointer; }
        .recipe-item:active { background: #E8E8E8; }

        /* èœè°±è¯¦æƒ…é¡µ */
        .recipe-detail { padding: 60px 24px 100px; overflow-y: auto; }
        .back-btn { font-size: 24px; cursor: pointer; margin-bottom: 16px; color: #6750A4; }
        .recipe-detail-header { margin-bottom: 24px; }
        .recipe-detail-name { font-size: 28px; font-weight: 700; color: #1C1B1F; margin-bottom: 12px; }
        .section-title { font-size: 18px; font-weight: 600; color: #1C1B1F; margin: 24px 0 12px; }
        .ingredient-item { padding: 12px; background: #F5F5F5; border-radius: 8px; margin-bottom: 8px; }
        .step-item { padding: 12px; background: #F5F5F5; border-radius: 8px; margin-bottom: 8px; }
        .step-number { display: inline-block; background: #6750A4; color: #fff; width: 24px; height: 24px; border-radius: 50%; text-align: center; line-height: 24px; font-size: 12px; margin-right: 8px; }

        /* æ·»åŠ èœè°±é¡µ */
        .add-recipe { padding: 60px 24px 100px; overflow-y: auto; }
        .form-group { margin-bottom: 20px; }
        .form-label { font-size: 14px; color: #49454F; margin-bottom: 8px; display: block; }
        .form-input { width: 100%; padding: 12px; border: 1px solid #E8E8E8; border-radius: 8px; font-size: 16px; }
        .form-textarea { width: 100%; padding: 12px; border: 1px solid #E8E8E8; border-radius: 8px; font-size: 16px; min-height: 100px; resize: vertical; }
        .save-btn { width: 100%; padding: 16px; background: #6750A4; color: #fff; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; }
        .config-options { display: flex; gap: 8px; flex-wrap: wrap; }
        .option-btn { background: #F5F5F5; color: #6750A4; border: 2px solid transparent; padding: 8px 16px; border-radius: 20px; cursor: pointer; transition: all 0.2s; font-size: 14px; }
        .option-btn.active { background: #E8DEF8; border-color: #6750A4; }
        .dynamic-list { display: flex; flex-direction: column; gap: 12px; }
        .dynamic-item { display: flex; gap: 8px; align-items: stretch; }
        .dynamic-item input, .dynamic-item select { padding: 12px; border: 1px solid #E8E8E8; border-radius: 8px; font-size: 14px; }
        .dynamic-item .ingredient-name { flex: 2; }
        .dynamic-item .ingredient-amount { flex: 0 0 70px; text-align: center; }
        .dynamic-item .ingredient-unit { flex: 0 0 70px; }
        .dynamic-item .step-desc { flex: 1; }
        .remove-btn { background: #F5F5F5; color: #79747E; border: none; width: 40px; height: 40px; border-radius: 8px; cursor: pointer; font-size: 20px; flex-shrink: 0; }
        .remove-btn:active { background: #E8E8E8; }
        .add-item-btn { background: #E8DEF8; color: #6750A4; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500; margin-top: 4px; width: 100%; }
        .add-item-btn:active { background: #D5C4F0; }
    </style>
</head>
<body>
    <div class="phone-frame">
        <div class="status-bar">
            <span>9:41</span>
            <span>ğŸ“¶ ğŸ“¡ ğŸ”‹</span>
        </div>
        <div class="screen">
            <!-- ä¸»é¡µ - Rollç‚¹ -->
            <div class="page home" id="home">
                <div class="home-header">
                    <h1>ğŸœ åƒç‚¹å•¥</h1>
                    <p>ä»Šå¤©åšä»€ä¹ˆèœï¼Ÿè®©æˆ‘å¸®ä½ å†³å®š</p>
                </div>
                <div class="roll-button" onclick="rollMeal()">
                    <div class="roll-button-inner">
                        <div class="roll-button-icon">ğŸ²</div>
                        <div class="roll-button-text">Rollç‚¹ï¼</div>
                    </div>
                </div>
                <div class="progressive-config" id="progressiveConfig">
                    <div class="config-btn" onclick="showDishCountSelector()">å‡ ä¸ªèœ</div>
                </div>
            </div>

            <!-- é€‰æ‹©å™¨å¼¹çª— -->
            <div class="selector-overlay" id="selectorOverlay" onclick="hideSelector(event)">
                <div class="selector-panel" onclick="event.stopPropagation()">
                    <div class="selector-title" id="selectorTitle">é€‰æ‹©èœæ•°</div>
                    <div class="selector-options" id="selectorOptions"></div>
                </div>
            </div>

            <!-- ç»“æœé¡µ -->
            <div class="page result-page hidden" id="result">
                <div class="result-header">
                    <h2>ä»Šå¤©å°±åšè¿™äº›ï¼</h2>
                    <div class="result-summary" id="resultSummary"></div>
                </div>
                <div id="resultList"></div>
                <div class="action-buttons">
                    <button class="btn btn-secondary" onclick="rollMeal()">é‡æ–°Roll</button>
                    <button class="btn btn-primary" onclick="confirmMeal()">å°±è¿™äº›äº†</button>
                </div>
            </div>

            <!-- å†å²é¡µ -->
            <div class="page recipes-page hidden" id="history">
                <div class="recipes-header">
                    <div class="recipes-title">å†å²è®°å½•</div>
                </div>
                <div class="recipes-list" id="historyList">
                    <div style="text-align: center; padding: 60px 24px; color: #79747E;">
                        æš‚æ— å†å²è®°å½•
                    </div>
                </div>
            </div>

            <!-- èœè°±é¡µ -->
            <div class="page recipes-page hidden" id="recipes">
                <div class="recipes-header">
                    <div class="recipes-title">æˆ‘çš„èœè°±</div>
                    <div class="add-btn" onclick="showAddRecipe()">+</div>
                </div>
                <div class="filter-tabs">
                    <div class="filter-tab active">å…¨éƒ¨</div>
                    <div class="filter-tab">è¤èœ</div>
                    <div class="filter-tab">ç´ èœ</div>
                    <div class="filter-tab">æ±¤</div>
                    <div class="filter-tab">ä¸»é£Ÿ</div>
                </div>
                <div class="recipes-list" id="recipesList"></div>
            </div>

            <!-- èœè°±è¯¦æƒ…é¡µ -->
            <div class="page recipe-detail hidden" id="recipeDetail">
                <div class="back-btn" onclick="showRecipes()">â† è¿”å›</div>
                <div class="recipe-detail-header">
                    <div class="recipe-detail-name" id="detailName">å®«ä¿é¸¡ä¸</div>
                    <div class="dish-tags">
                        <span class="tag" id="detailType">è¤èœ</span>
                        <span class="tag" id="detailDifficulty">ä¸­ç­‰</span>
                        <span class="tag" id="detailTime">30åˆ†é’Ÿ</span>
                    </div>
                </div>
                <div class="section-title">é£Ÿæ</div>
                <div id="detailIngredients"></div>
                <div class="section-title">æ­¥éª¤</div>
                <div id="detailSteps"></div>
            </div>

            <!-- æ·»åŠ èœè°±é¡µ -->
            <div class="page add-recipe hidden" id="addRecipe">
                <div class="back-btn" onclick="showRecipes()">â† è¿”å›</div>
                <h2 style="font-size: 24px; margin-bottom: 24px;">æ·»åŠ èœè°±</h2>
                <div class="form-group">
                    <label class="form-label">èœå</label>
                    <input type="text" class="form-input" id="recipeName" placeholder="ä¾‹å¦‚ï¼šå®«ä¿é¸¡ä¸">
                </div>
                <div class="form-group">
                    <label class="form-label">ç±»å‹</label>
                    <div class="config-options" id="recipeType">
                        <div class="option-btn active" data-value="meat">è¤èœ</div>
                        <div class="option-btn" data-value="veg">ç´ èœ</div>
                        <div class="option-btn" data-value="soup">æ±¤</div>
                        <div class="option-btn" data-value="staple">ä¸»é£Ÿ</div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">éš¾åº¦</label>
                    <div class="config-options" id="recipeDifficulty">
                        <div class="option-btn active" data-value="ç®€å•">ç®€å•</div>
                        <div class="option-btn" data-value="ä¸­ç­‰">ä¸­ç­‰</div>
                        <div class="option-btn" data-value="å›°éš¾">å›°éš¾</div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">é¢„è®¡æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰</label>
                    <input type="number" class="form-input" id="recipeTime" placeholder="30" value="30">
                </div>
                <div class="form-group">
                    <label class="form-label">é£Ÿæ</label>
                    <div class="dynamic-list" id="ingredientsList">
                        <div class="dynamic-item">
                            <input type="text" placeholder="ä¾‹å¦‚ï¼šé¸¡èƒ¸è‚‰" class="ingredient-name">
                            <input type="text" placeholder="200" class="ingredient-amount">
                            <select class="ingredient-unit">
                                <option>g</option>
                                <option>ml</option>
                                <option>ä¸ª</option>
                                <option>å‹º</option>
                                <option>é€‚é‡</option>
                            </select>
                            <button class="remove-btn" onclick="removeItem(this)">Ã—</button>
                        </div>
                    </div>
                    <button class="add-item-btn" onclick="addIngredient()">+ æ·»åŠ é£Ÿæ</button>
                </div>
                <div class="form-group">
                    <label class="form-label">æ­¥éª¤</label>
                    <div class="dynamic-list" id="stepsList">
                        <div class="dynamic-item">
                            <input type="text" placeholder="æ­¥éª¤æè¿°" class="step-desc">
                            <button class="remove-btn" onclick="removeItem(this)">Ã—</button>
                        </div>
                    </div>
                    <button class="add-item-btn" onclick="addStep()">+ æ·»åŠ æ­¥éª¤</button>
                </div>
                <button class="save-btn" onclick="saveRecipe()">ä¿å­˜èœè°±</button>
            </div>

            <!-- åº•éƒ¨å¯¼èˆª -->
            <div class="bottom-nav">
                <div class="nav-item active" onclick="showHome()">
                    <div class="nav-icon">ğŸ²</div>
                    <div class="nav-label">Rollç‚¹</div>
                </div>
                <div class="nav-item" onclick="showRecipes()">
                    <div class="nav-icon">ğŸ“–</div>
                    <div class="nav-label">èœè°±</div>
                </div>
                <div class="nav-item" onclick="showHistory()">
                    <div class="nav-icon">ğŸ“œ</div>
                    <div class="nav-label">å†å²</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const recipes = [
            { name: 'å®«ä¿é¸¡ä¸', type: 'meat', icon: 'ğŸ—', difficulty: 'ä¸­ç­‰', time: '30åˆ†é’Ÿ', ingredients: ['é¸¡èƒ¸è‚‰ 200g', 'èŠ±ç”Ÿç±³ 50g', 'å¹²è¾£æ¤’ 10ä¸ª', 'èŠ±æ¤’ 1å‹º'], steps: ['é¸¡è‚‰åˆ‡ä¸ï¼ŒåŠ æ–™é…’è…Œåˆ¶', 'çƒ­æ²¹ç‚’èŠ±ç”Ÿç±³è‡³é‡‘é»„', 'çˆ†é¦™å¹²è¾£æ¤’å’ŒèŠ±æ¤’', 'ä¸‹é¸¡ä¸ç‚’è‡³å˜è‰²', 'åŠ å…¥è°ƒå‘³æ–™ç¿»ç‚’å‡åŒ€'] },
            { name: 'æ¸…ç‚’è¥¿å…°èŠ±', type: 'veg', icon: 'ğŸ¥¦', difficulty: 'ç®€å•', time: '15åˆ†é’Ÿ', ingredients: ['è¥¿å…°èŠ± 1ä¸ª', 'å¤§è’œ 3ç“£', 'ç› é€‚é‡'], steps: ['è¥¿å…°èŠ±åˆ‡å°æœµç„¯æ°´', 'è’œåˆ‡ç‰‡çˆ†é¦™', 'ä¸‹è¥¿å…°èŠ±å¿«é€Ÿç¿»ç‚’', 'åŠ ç›è°ƒå‘³å‡ºé”…'] },
            { name: 'ç•ªèŒ„ç‚’è›‹', type: 'veg', icon: 'ğŸ…', difficulty: 'ç®€å•', time: '10åˆ†é’Ÿ', ingredients: ['ç•ªèŒ„ 2ä¸ª', 'é¸¡è›‹ 3ä¸ª', 'ç³– 1å‹º'], steps: ['é¸¡è›‹æ‰“æ•£ç‚’ç†Ÿç››å‡º', 'ç•ªèŒ„åˆ‡å—ç‚’å‡ºæ±', 'åŠ å…¥é¸¡è›‹ç¿»ç‚’', 'åŠ ç³–ç›è°ƒå‘³'] },
            { name: 'çº¢çƒ§è‚‰', type: 'meat', icon: 'ğŸ¥©', difficulty: 'ä¸­ç­‰', time: '60åˆ†é’Ÿ', ingredients: ['äº”èŠ±è‚‰ 500g', 'å†°ç³– 30g', 'å…«è§’ 2ä¸ª'], steps: ['äº”èŠ±è‚‰åˆ‡å—ç„¯æ°´', 'ç‚’ç³–è‰²', 'ä¸‹è‚‰å—ä¸Šè‰²', 'åŠ æ°´å’Œè°ƒæ–™ç‚–ç…®40åˆ†é’Ÿ', 'å¤§ç«æ”¶æ±'] },
            { name: 'ç´«èœè›‹èŠ±æ±¤', type: 'soup', icon: 'ğŸ²', difficulty: 'ç®€å•', time: '10åˆ†é’Ÿ', ingredients: ['ç´«èœ 10g', 'é¸¡è›‹ 2ä¸ª', 'è™¾çš® é€‚é‡'], steps: ['æ°´çƒ§å¼€ä¸‹ç´«èœ', 'åŠ å…¥è™¾çš®', 'æ·‹å…¥è›‹æ¶²', 'åŠ ç›é¦™æ²¹è°ƒå‘³'] },
            { name: 'é…¸è¾£åœŸè±†ä¸', type: 'veg', icon: 'ğŸ¥”', difficulty: 'ç®€å•', time: '15åˆ†é’Ÿ', ingredients: ['åœŸè±† 2ä¸ª', 'å¹²è¾£æ¤’ 5ä¸ª', 'é†‹ 2å‹º'], steps: ['åœŸè±†åˆ‡ä¸æ³¡æ°´', 'çƒ­æ²¹çˆ†é¦™è¾£æ¤’', 'ä¸‹åœŸè±†ä¸å¿«ç‚’', 'åŠ é†‹ç›è°ƒå‘³'] },
        ];

        let config = { total: 0, meat: 0, veg: 0, soup: 0 };
        let currentSelector = '';
        let history = [];
        let currentResult = null;

        function showDishCountSelector() {
            currentSelector = 'total';
            document.getElementById('selectorTitle').textContent = 'é€‰æ‹©èœæ•°';
            const options = [2,3,4,5,6,7].map(n =>
                `<div class="selector-option" onclick="selectDishCount(${n})">${n}ä¸ªèœ</div>`
            ).join('');
            document.getElementById('selectorOptions').innerHTML = options;
            document.getElementById('selectorOverlay').classList.add('show');
        }

        function selectDishCount(n) {
            config.total = n;
            config.meat = 0;
            config.veg = 0;
            config.soup = 0;
            hideSelector();
            updateConfigUI();
        }

        function showTypeSelector(type) {
            currentSelector = type;
            const typeNames = { meat: 'è¤èœ', veg: 'ç´ èœ', soup: 'æ±¤' };
            document.getElementById('selectorTitle').textContent = `é€‰æ‹©${typeNames[type]}æ•°é‡`;

            const used = config.meat + config.veg + config.soup - config[type];
            const available = config.total - used;

            let options = '';
            for (let i = 0; i <= available; i++) {
                options += `<div class="selector-option" onclick="selectTypeCount('${type}', ${i})">${i}</div>`;
            }
            document.getElementById('selectorOptions').innerHTML = options;
            document.getElementById('selectorOverlay').classList.add('show');
        }

        function selectTypeCount(type, n) {
            config[type] = n;
            hideSelector();
            updateConfigUI();
        }

        function updateConfigUI() {
            const container = document.getElementById('progressiveConfig');
            let html = `<div class="config-row">
                <div class="config-btn small" onclick="showDishCountSelector()">${config.total}ä¸ªèœ</div>`;

            if (config.total > 0) {
                html += `<div class="config-btn small" onclick="showTypeSelector('meat')">è¤${config.meat > 0 ? config.meat : ''}</div>`;
                html += `<div class="config-btn small" onclick="showTypeSelector('veg')">ç´ ${config.veg > 0 ? config.veg : ''}</div>`;
                html += `<div class="config-btn small" onclick="showTypeSelector('soup')">æ±¤${config.soup > 0 ? config.soup : ''}</div>`;
            }
            html += '</div>';
            container.innerHTML = html;
        }

        function hideSelector(event) {
            if (!event || event.target.id === 'selectorOverlay') {
                document.getElementById('selectorOverlay').classList.remove('show');
            }
        }

        function rollMeal() {
            const meatRecipes = recipes.filter(r => r.type === 'meat');
            const vegRecipes = recipes.filter(r => r.type === 'veg');
            const soupRecipes = recipes.filter(r => r.type === 'soup');

            let selected = [];

            if (config.total === 0) {
                // æœªé…ç½®ï¼Œéšæœº1ä¸ªèœ
                const allDishes = [...meatRecipes, ...vegRecipes];
                selected.push(allDishes[Math.floor(Math.random() * allDishes.length)]);
            } else {
                // æŒ‰é…ç½®é€‰æ‹©
                for (let i = 0; i < config.meat; i++) {
                    const r = meatRecipes[Math.floor(Math.random() * meatRecipes.length)];
                    if (!selected.includes(r)) selected.push(r);
                }
                for (let i = 0; i < config.veg; i++) {
                    const r = vegRecipes[Math.floor(Math.random() * vegRecipes.length)];
                    if (!selected.includes(r)) selected.push(r);
                }
                for (let i = 0; i < config.soup; i++) {
                    const r = soupRecipes[Math.floor(Math.random() * soupRecipes.length)];
                    if (!selected.includes(r)) selected.push(r);
                }
            }

            let summary = '';
            if (config.total === 0) {
                summary = 'éšæœº1ä¸ªèœ';
            } else {
                const parts = [];
                if (config.meat > 0) parts.push(`${config.meat}è¤`);
                if (config.veg > 0) parts.push(`${config.veg}ç´ `);
                if (config.soup > 0) parts.push(`${config.soup}æ±¤`);
                summary = `${config.total}èœ Â· ${parts.join('')}`;
            }
            document.getElementById('resultSummary').textContent = summary;

            currentResult = {
                config: {...config},
                recipes: selected,
                summary: summary,
                timestamp: Date.now()
            };

            const html = selected.map(r => `
                <div class="dish-card" onclick="showRecipeDetail('${r.name}')" style="cursor: pointer;">
                    <div class="dish-header">
                        <div class="dish-icon">${r.icon}</div>
                        <div class="dish-info">
                            <div class="dish-name">${r.name}</div>
                            <div class="dish-tags">
                                <span class="tag">${r.type === 'meat' ? 'è¤èœ' : r.type === 'veg' ? 'ç´ èœ' : 'æ±¤'}</span>
                                <span class="tag">${r.difficulty}</span>
                                <span class="tag">${r.time}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
            document.getElementById('resultList').innerHTML = html;

            showPage('result');
        }

        function confirmMeal() {
            if (currentResult) {
                history.push(currentResult);
            }
            alert('å·²ä¿å­˜åˆ°å†å²è®°å½•ï¼');
            showHome();
        }

        function showRecipes() {
            const html = recipes.map(r => `
                <div class="recipe-item" onclick="showRecipeDetail('${r.name}')">
                    <div class="dish-icon">${r.icon}</div>
                    <div class="dish-info">
                        <div class="dish-name">${r.name}</div>
                        <div class="dish-tags">
                            <span class="tag">${r.type === 'meat' ? 'è¤èœ' : r.type === 'veg' ? 'ç´ èœ' : 'æ±¤'}</span>
                            <span class="tag">${r.difficulty}</span>
                        </div>
                    </div>
                </div>
            `).join('');
            document.getElementById('recipesList').innerHTML = html;
            showPage('recipes');
            updateNav(1);
        }

        function showRecipeDetail(name) {
            const recipe = recipes.find(r => r.name === name);
            document.getElementById('detailName').textContent = recipe.name;
            document.getElementById('detailType').textContent = recipe.type === 'meat' ? 'è¤èœ' : recipe.type === 'veg' ? 'ç´ èœ' : 'æ±¤';
            document.getElementById('detailDifficulty').textContent = recipe.difficulty;
            document.getElementById('detailTime').textContent = recipe.time;

            const ingredientsHtml = recipe.ingredients.map(i => `
                <div class="ingredient-item">${i}</div>
            `).join('');
            document.getElementById('detailIngredients').innerHTML = ingredientsHtml;

            const stepsHtml = recipe.steps.map((s, i) => `
                <div class="step-item">
                    <span class="step-number">${i + 1}</span>${s}
                </div>
            `).join('');
            document.getElementById('detailSteps').innerHTML = stepsHtml;

            showPage('recipeDetail');
        }

        function showAddRecipe() {
            showPage('addRecipe');
        }

        function addIngredient() {
            const list = document.getElementById('ingredientsList');
            const item = document.createElement('div');
            item.className = 'dynamic-item';
            item.innerHTML = `
                <input type="text" placeholder="ä¾‹å¦‚ï¼šé¸¡èƒ¸è‚‰" class="ingredient-name">
                <input type="text" placeholder="200" class="ingredient-amount">
                <select class="ingredient-unit">
                    <option>g</option>
                    <option>ml</option>
                    <option>ä¸ª</option>
                    <option>å‹º</option>
                    <option>é€‚é‡</option>
                </select>
                <button class="remove-btn" onclick="removeItem(this)">Ã—</button>
            `;
            list.appendChild(item);
        }

        function addStep() {
            const list = document.getElementById('stepsList');
            const item = document.createElement('div');
            item.className = 'dynamic-item';
            item.innerHTML = `
                <input type="text" placeholder="æ­¥éª¤æè¿°" class="step-desc">
                <button class="remove-btn" onclick="removeItem(this)">Ã—</button>
            `;
            list.appendChild(item);
        }

        function removeItem(btn) {
            const item = btn.parentElement;
            const list = item.parentElement;
            if (list.children.length > 1) {
                item.remove();
            } else {
                alert('è‡³å°‘ä¿ç•™ä¸€é¡¹');
            }
        }

        function saveRecipe() {
            alert('èœè°±å·²ä¿å­˜ï¼');
            showRecipes();
        }

        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('option-btn')) {
                const parent = e.target.parentElement;
                parent.querySelectorAll('.option-btn').forEach(btn => btn.classList.remove('active'));
                e.target.classList.add('active');
            }
        });

        function showHistory() {
            if (history.length === 0) {
                document.getElementById('historyList').innerHTML = `
                    <div style="text-align: center; padding: 60px 24px; color: #79747E;">
                        æš‚æ— å†å²è®°å½•
                    </div>
                `;
            } else {
                const html = history.map((item, index) => {
                    const date = new Date(item.timestamp);
                    const timeStr = `${date.getMonth()+1}æœˆ${date.getDate()}æ—¥ ${date.getHours()}:${String(date.getMinutes()).padStart(2,'0')}`;
                    const dishNames = item.recipes.map(r => r.name).join('ã€');
                    return `
                        <div class="recipe-item" onclick="showHistoryDetail(${index})">
                            <div class="dish-icon">ğŸ“‹</div>
                            <div class="dish-info">
                                <div class="dish-name">${item.summary}</div>
                                <div style="font-size: 14px; color: #79747E; margin-top: 4px;">${dishNames}</div>
                                <div class="dish-tags">
                                    <span class="tag">${timeStr}</span>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                document.getElementById('historyList').innerHTML = html;
            }
            showPage('history');
            updateNav(2);
        }

        function showHistoryDetail(index) {
            const item = history[index];
            const date = new Date(item.timestamp);
            const timeStr = `${date.getMonth()+1}æœˆ${date.getDate()}æ—¥ ${date.getHours()}:${String(date.getMinutes()).padStart(2,'0')}`;

            const html = `
                <div class="back-btn" onclick="showHistory()">â† è¿”å›</div>
                <div class="result-header">
                    <h2>${item.summary}</h2>
                    <div class="result-summary">${timeStr}</div>
                </div>
                ${item.recipes.map(r => `
                    <div class="dish-card" onclick="showRecipeDetail('${r.name}')" style="cursor: pointer;">
                        <div class="dish-header">
                            <div class="dish-icon">${r.icon}</div>
                            <div class="dish-info">
                                <div class="dish-name">${r.name}</div>
                                <div class="dish-tags">
                                    <span class="tag">${r.type === 'meat' ? 'è¤èœ' : r.type === 'veg' ? 'ç´ èœ' : 'æ±¤'}</span>
                                    <span class="tag">${r.difficulty}</span>
                                    <span class="tag">${r.time}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('')}
            `;

            const detailPage = document.createElement('div');
            detailPage.className = 'page result-page';
            detailPage.id = 'historyDetail';
            detailPage.innerHTML = html;

            const oldDetail = document.getElementById('historyDetail');
            if (oldDetail) oldDetail.remove();

            document.querySelector('.screen').appendChild(detailPage);
            showPage('historyDetail');
        }

        function showHome() {
            showPage('home');
            updateNav(0);
        }

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.add('hidden');
            });
            document.getElementById(pageId).classList.remove('hidden');
        }

        function updateNav(index) {
            document.querySelectorAll('.nav-item').forEach((item, i) => {
                item.classList.toggle('active', i === index);
            });
        }
    </script>
</body>
</html>